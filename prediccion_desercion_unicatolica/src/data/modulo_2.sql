CREATE TABLE promedios AS
SELECT ID_ESTUDIANTE AS id_estudiante,PERIODO_ACADEMICO AS periodo,PGA AS promedio FROM PGA
WHERE ID_ESTUDIANTE IN (SELECT ID_ESTUDIANTE FROM Estudiantes_UNIS)
ORDER BY ID_ESTUDIANTE;

UPDATE promedios SET periodo = 202210
WHERE periodo = 202201;

CREATE VIEW promedios_final AS
SELECT
    id_estudiante,
    COALESCE(MAX(CASE WHEN periodo = 201810 THEN promedio END),0) AS p201810,
    COALESCE(MAX(CASE WHEN periodo = 201830 THEN promedio END),0) AS p201830,
    COALESCE(MAX(CASE WHEN periodo = 201860 THEN promedio END),0) AS p201860,
    COALESCE(MAX(CASE WHEN periodo = 201880 THEN promedio END),0) AS p201880,
    COALESCE(MAX(CASE WHEN periodo = 201910 THEN promedio END),0) AS p201910,
    COALESCE(MAX(CASE WHEN periodo = 201930 THEN promedio END),0) AS p201930,
    COALESCE(MAX(CASE WHEN periodo = 201960 THEN promedio END),0) AS p201960,
    COALESCE(MAX(CASE WHEN periodo = 201980 THEN promedio END),0) AS p201980,
    COALESCE(MAX(CASE WHEN periodo = 202010 THEN promedio END),0) AS p202010,
    COALESCE(MAX(CASE WHEN periodo = 202030 THEN promedio END),0) AS p202030,
    COALESCE(MAX(CASE WHEN periodo = 202060 THEN promedio END),0) AS p202060,
    COALESCE(MAX(CASE WHEN periodo = 202080 THEN promedio END),0) AS p202080,
    COALESCE(MAX(CASE WHEN periodo = 202110 THEN promedio END),0) AS p202110,
    COALESCE(MAX(CASE WHEN periodo = 202160 THEN promedio END),0) AS p202160,
    COALESCE(MAX(CASE WHEN periodo = 202180 THEN promedio END),0) AS p202180,
    COALESCE(MAX(CASE WHEN periodo = 202210 THEN promedio END),0) AS p202210,
    COALESCE(MAX(CASE WHEN periodo = 202215 THEN promedio END),0) AS p202215,
    COALESCE(MAX(CASE WHEN periodo = 202220 THEN promedio END),0) AS p202220,
    COALESCE(MAX(CASE WHEN periodo = 202225 THEN promedio END),0) AS p202225,
    COALESCE(MAX(CASE WHEN periodo = 202310 THEN promedio END),0) AS p202310,
    COALESCE(MAX(CASE WHEN periodo = 202315 THEN promedio END),0) AS p202315,
    COALESCE(MAX(CASE WHEN periodo = 202320 THEN promedio END),0) AS p202320,
    COALESCE(MAX(CASE WHEN periodo = 202325 THEN promedio END),0) AS p202325,
    COALESCE(MAX(CASE WHEN periodo = 202410 THEN promedio END),0) AS p202410,
    COALESCE(MAX(CASE WHEN periodo = 202415 THEN promedio END),0) AS p202415,
    COALESCE(MAX(CASE WHEN periodo = 202420 THEN promedio END),0) AS p202420,
    COALESCE(MAX(CASE WHEN periodo = 202425 THEN promedio END),0) AS p202425
FROM promedios
GROUP BY id_estudiante;
